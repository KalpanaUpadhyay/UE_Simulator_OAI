üîê Authentication Message Flow (LTE/5G)
This is part of the NAS (Non-Access Stratum) layer over the control plane.

üß≠ High-Level Flow:
UE                   MME/AMF                HSS/UDM/AUSF
 |                      |                        |
 |-- Attach/Reg Req --> |                        |
 |                      |-- IDENTITY REQ/RES --> |
 |                      |-- AUTHENTICATION DATA REQUEST --> |
 |                      |                        |
 |                      |<-- AUTHENTICATION DATA RESPONSE --|
 |<-- Authentication Request --|                 
 |-- Authentication Response -->|
 |-- Security Mode Complete -->|

üì© 1. UE Sends:
Attach Request (LTE) or Registration Request (5G)
Includes:

IMSI or temporary ID (GUTI/SUCI)

Requested NSSAI (5G)

UE capabilities

Optional: last visited cell, KSI (Key Set Identifier)

üìë 2. Network Responds:
Identity Request (if needed)
If the UE sends a temporary ID, MME/AMF may ask for the IMSI using:

Message: Identity Request
UE responds with:

Message: Identity Response (IMSI)

üîê 3. Authentication Challenge
MME/AMF sends:
Message: Authentication Request
Contains these critical parameters:

Field	Description
RAND	Random number generated by the HSS/AUSF
AUTN	Authentication token (used to verify network identity)
KSI	Key Set Identifier
Ciphering & Integrity Alg	Proposed algorithms

These are received from HSS (LTE) or AUSF + UDM (5G) based on UE's IMSI.

üîê 4. UE Verifies Network + Responds
UE uses its K and OPC keys (from the SIM) to compute:

Verify the network using AUTN

Compute a response RES

Then it sends:

Message: Authentication Response
Contains:

RES (Response to the RAND challenge)

KSI

‚úÖ 5. Network Verifies UE
MME/AMF compares UE‚Äôs RES with expected value XRES from HSS/AUSF.

If matches ‚Üí Authentication Success

If not ‚Üí Authentication Failure

üîê 6. Next Steps After Authentication
Once authenticated:

MME/AMF sends Security Mode Command

UE replies with Security Mode Complete

Encryption and integrity protection start

Then:

Bearer setup

IP address assignment

Session management

üß† Summary of Key Authentication Parameters

| Parameter        | Sent By | Description                   |
| ---------------- | ------- | ----------------------------- |
| `IMSI` or `SUCI` | UE      | Unique subscriber ID          |
| `RAND`           | HSS/UDM | Random nonce                  |
| `AUTN`           | HSS/UDM | Network auth token            |
| `RES`            | UE      | Response to RAND              |
| `XRES`           | HSS     | Expected response             |
| `K` + `OPC`      | SIM     | Secret keys used in algorithm |


üõ†Ô∏è Algorithms Used
AKA (Authentication and Key Agreement) for LTE

5G-AKA / EAP-AKA‚Äô for 5G

Cryptographic functions like f1, f2, f3... to compute MAC, RES, ciphering keys, etc.

üîç Debug Tip
In Wireshark:

Filter with nas-eps or nas-5gs

Look for:

Authentication Request

Authentication Response

Security Mode Command

Attach Accept / Complete
