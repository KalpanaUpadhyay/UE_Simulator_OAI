ğŸ›°ï¸ 4G Message Flow in OAI UE Simulator (Typical Attach and Data Session):
Let's go through the message flow layer by layer (RRC + NAS):

ğŸŸ¦ 1. RRC Connection Setup (RAN Level - UE <-> eNodeB):
UE Simulator	eNodeB
RRC Connection Request	â† UE initiates connection (Random Access).
RRC Connection Setup	â†’ eNB allocates resources and sends config.
RRC Connection Setup Complete	â† UE sends back setup complete.

ğŸŸ¨ 2. NAS Attach Procedure (Core Level - UE <-> MME):
UE Simulator	MME
Attach Request (NAS)	â† Includes IMSI, UE capabilities, etc.
Authentication Request	â†’ From MME via eNB (challenge).
Authentication Response	â† UE sends response (based on key).
Security Mode Command	â†’ To start NAS encryption/integrity.
Security Mode Complete	â† Acknowledges security context setup.
Attach Accept	â†’ MME accepts and assigns GUTI.
Attach Complete	â† UE acknowledges.

Behind the scenes: MME interacts with HSS for IMSI â†’ Authentication, and SGW/PGW to allocate an IP.

ğŸŸ© 3. ESM (Session Management) - Bearer Setup:
UE Simulator	MME + SGW/PGW
Create Session Request	â†’ MME asks PGW to create default bearer.
Create Session Response	â† PGW responds with IP, bearer info.
Initial Context Setup	â†’ MME instructs eNB to setup DRB.
Default Bearer Activation	â† UE is informed of IP and bearer.

ğŸ“¡ 4. Data Transfer (IP layer):
Once the bearer is up:

UE can ping the remote IPs.

UE can run iperf to test throughput.

IP packets are tunneled through GTP-U over S1-U interface.

ğŸ§ª Use Cases of UE Simulator:
Test eNodeB under controlled conditions.

Core network protocol stack testing.

Load testing multiple UEs (mass attach/detach).

Debugging issues in NAS, RRC, and bearer procedures.

ğŸ§° Relevant Directories in OAI UE:
If you're exploring OAI UE source code:

openair3/ â€“ NAS and ESM layers.

openair2/ â€“ RRC, PDCP, RLC, MAC.

openair1/ â€“ PHY.

targets/PROJECTS/ â€“ Entry points and configs.

ğŸ” Summary Flow Diagram (Simplified):
[UE Sim] â†’ RRC Req â†’ [eNB]
        â† RRC Setup â†
        â†’ RRC Comp â†’
        â†’ Attach Req (NAS) â†’
            â†’ Auth Req â†’
            â† Auth Res â†
            â†’ Sec Mode Cmd â†’
            â† Sec Mode Comp â†
            â†’ Attach Accept â†’
            â† Attach Complete â†
        â†’ Bearer Setup â†’ [MME + SGW/PGW]
        â† Bearer Accept â†
        â†’ IP Data (ping/iperf) â†’
